title: "Research"
author: "Richard Lussier"
date: "12/9/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library('ggplot2')
library('dplyr')
```


```{r}
researchData = read.table("MiddleCharData.txt", header=T, sep="\t")

researchData$NumFailedCases <- as.numeric(researchData$NumFailedCases)
researchData$TotalError <- as.numeric(researchData$TotalError)
researchData$StepLimit <- as.numeric(researchData$StepLimit)
researchData$FailedByStepLimit <- as.numeric(researchData$FailedByStepLimit)
researchData$RunNumber <- as.numeric(researchData$RunNumber)
researchData$Succeeded. <- as.logical(researchData$Succeeded.)
researchData$Generalized. <- as.logical(researchData$Generalized.)

#plot(x=researchData$StepLimit, y=log(researchData$TotalError)) + geom_point(alpha=0.1)

ggplot(researchData, aes(x=StepLimit, y=NumFailedCases, color=factor(Generalized.))) + geom_point(alpha=0.1)

ggplot(researchData, aes(x=StepLimit, y=NumFailedCases, group=factor(RunNumber))) + geom_line(alpha=0.1)
```

Let's add a new column that is true if `FailedCases = FailedByStepLimit`:

```{r}
researchData$AllFailuresOutOfSteps = (researchData$NumFailedCases == researchData$FailedByStepLimit)

equalFailures = subset(researchData, researchData$AllFailuresOutOfSteps)

nrow(equalFailures)

ggplot(equalFailures, aes(x=StepLimit, y=NumFailedCases, group=factor(RunNumber), color=factor(RunNumber))) + geom_line(alpha=0.5, show.legend=FALSE)
```
```{r}
fewFailedCases <- equalFailures %>%
  group_by(RunNumber) %>%
  filter(max(NumFailedCases) < 250)

ggplot(fewFailedCases, aes(x=StepLimit, y=NumFailedCases, group=factor(RunNumber), color=factor(RunNumber))) + geom_line(alpha=0.5, show.legend=TRUE)
```
```{r}
fourFiveand92 <- equalFailures %>%
  group_by(RunNumber) %>%
  filter(RunNumber == 95 || RunNumber == 37)

ggplot(fourFiveand92, aes(x=StepLimit, y=NumFailedCases, group=factor(RunNumber), color=factor(RunNumber))) + geom_line(alpha=0.5, show.legend=TRUE)
```

```{r}
middleFailedCases <- equalFailures %>%
  group_by(RunNumber) %>%
  filter(max(NumFailedCases) >= 750 && max(NumFailedCases) < 1250)

ggplot(middleFailedCases, aes(x=StepLimit, y=NumFailedCases, group=factor(RunNumber), color=factor(RunNumber))) + geom_line(alpha=0.5, show.legend=FALSE)
```
```{r}
higherFailedCases <- equalFailures %>%
  group_by(RunNumber) %>%
  filter(max(NumFailedCases) >= 1250 && max(NumFailedCases) < 1970)

ggplot(higherFailedCases, aes(x=StepLimit, y=NumFailedCases, group=factor(RunNumber), color=factor(RunNumber))) + geom_line(alpha=0.5, show.legend=FALSE)
```
```{r}
highestFailedCases <- equalFailures %>%
  group_by(RunNumber) %>%
  filter(max(NumFailedCases) >= 1970 && max(NumFailedCases) < 2001)

ggplot(highestFailedCases, aes(x=StepLimit, y=NumFailedCases, group=factor(RunNumber), color=factor(RunNumber))) + geom_line(alpha=0.5, show.legend=FALSE)
```

```{r}
reachesZeroFailedCases <- equalFailures %>%
  group_by(RunNumber) %>%
  filter(min(NumFailedCases) == 0)

ggplot(reachesZeroFailedCases, aes(x=StepLimit, y=NumFailedCases, group=factor(RunNumber), color=factor(RunNumber))) + geom_line(alpha=0.5, show.legend=FALSE)
```

```{r}
run70 <- subset(equalFailures, equalFailures$RunNumber == 70)

ggplot(run70, aes(x=StepLimit, y=NumFailedCases, group=factor(RunNumber), color=factor(RunNumber))) + geom_line(alpha=0.5, show.legend=FALSE)

ggplot(run70, aes(x=as.numeric(StepLimit), y=as.numeric(NumFailedCases), group=factor(RunNumber), color=factor(RunNumber))) + geom_line(alpha=0.5, show.legend=FALSE) + xlim(1950,2020) + ylim(0,50)
```

```{r}
runsRunningOutAt2200 <- subset(researchData, (researchData$StepLimit == 2200) & (researchData$AllFailuresOutOfSteps) & researchData$TotalError > 0 & as.numeric(researchData$NumFailedCases) < 100)$RunNumber

runningOutAt2200 <- researchData %>%
  filter(RunNumber %in% runsRunningOutAt2200)

ggplot(runningOutAt2200, aes(x=StepLimit, y=NumFailedCases, group=factor(RunNumber), color=factor(RunNumber))) + geom_line(alpha=0.5, show.legend=FALSE)
```

```{r}
# The new AllFailuresOutOfSteps column is true for any program & step limit where
# that program fails all of its test cases because it runs out of steps. So if
# *any* case completes "normally" that (program, step limit) pair won't be set
# to TRUE here.
dataset$AllFailuresOutOfSteps = (dataset$FailedCases == dataset$FailedByStepLimit)

runsRunningOutAt350 <- subset(dataset, dataset$StepLimit == 350 & dataset$AllFailuresOutOfSteps & dataset$TotalError > 0 & dataset$FailedCases < 100)$RunNumber

runningOutAt350 <- dataset %>%
  filter(RunNumber %in% runsRunningOutAt350)

ggplot(runningOutAt350, aes(x=StepLimit, y=FailedCases, group=factor(RunNumber), color=factor(RunNumber))) + geom_line(alpha=0.5, show.legend=TRUE)
```

```{r}
# All the (program, step limit) pairs where where all failures
# came from running out of steps.
equalFailuresLastIndex = subset(dataset, dataset$AllFailuresOutOfSteps)

# All the programs (i.e., runs) that generalize for at least one
# step limit, i.e., min(FailedCases) == 0, i.e., the min across
# all the possible step limits is 0.
lastIndexOutOfSteps <- equalFailuresLastIndex %>%
  group_by(RunNumber) %>%
  filter(min(FailedCases) == 0)

#generalizedAtSomePoint <- subset(lastIndexOutOfSteps, lastIndexOutOfSteps$TotalError == 0)

# All the programs that generalize somewhere *other* than at
# step limit 200.
generalizedNotAt200 <- subset(lastIndexOutOfSteps, 
                              (lastIndexOutOfSteps$StepLimit == 200 
                               & lastIndexOutOfSteps$TotalError > 0))$RunNumber

generalizedAt200 <- subset(lastIndexOutOfSteps, (lastIndexOutOfSteps$StepLimit == 200 & lastIndexOutOfSteps$TotalError == 0))$RunNumber

didntGenAt200 <- dataset %>%
  filter(RunNumber %in% generalizedNotAt200)

generalizedSomewhereNot200 <- subset(didntGenAt200, didntGenAt200$TotalError == 0)$RunNumber

didntGenAt200 <- didntGenAt200 %>%
  filter(RunNumber %in% generalizedSomewhereNot200)

#Would most likely have to clean this up. Maybe limit the amount of runs per graph and have multiple?
ggplot(didntGenAt200, aes(x=StepLimit, y=FailedCases, group=factor(RunNumber), color=factor(RunNumber))) + geom_line(alpha=0.5, show.legend=FALSE)

```

```{r}
ggplot(didntGenAt200, aes(x=StepLimit, y=FailedCases, group=factor(RunNumber), color=factor(RunNumber))) + geom_line(alpha=0.5, show.legend=FALSE) + xlim(190, 210) + ylim(0, 20)
```

```{r}
someRunNumbersFailingLessThan20 <- head(unique(subset(didntGenAt200, (didntGenAt200$FailedCases < 20) & (didntGenAt200$StepLimit == 200))$RunNumber), 10)

someRunsFailingLessThan20 <- subset(didntGenAt200, didntGenAt200$RunNumber %in% someRunNumbersFailingLessThan20)

ggplot(someRunsFailingLessThan20, aes(x=StepLimit, y=FailedCases, group=factor(RunNumber), color=factor(RunNumber))) + geom_line(alpha=0.5, show.legend=FALSE) + xlim(190, 210) + ylim(0, 20)
```
